<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gilead Couriers — Book a Job</title>

    <style>
      /* PAGE-WIDE HERO BACKGROUND */
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 24px;
        color:#111;
        background:
          linear-gradient(180deg, rgba(11,31,59,0.92), rgba(11,31,59,0.65)),
          url("/app/images/hero-courier.jpg");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      }

      .wrap {
        max-width: 760px;
        margin: 0 auto;
      }

      /* FORM CARD */
      .card {
        background: rgba(255,255,255,0.94);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid rgba(255,255,255,0.6);
        box-shadow: 0 14px 34px rgba(0,0,0,0.18);
        backdrop-filter: blur(3px);
      }

      h1 { margin: 0 0 8px; font-size: 24px; }
      p.sub { margin: 0 0 20px; color:#444; }

      label { display:block; font-weight:600; margin: 14px 0 6px; }

      input, textarea {
        width:100%;
        box-sizing:border-box;
        padding: 10px 12px;
        border: 1px solid #d7dbe7;
        border-radius: 10px;
        font-size: 14px;
        background: #fff;
      }

      textarea { min-height: 76px; resize: vertical; }

      .row { display:flex; gap: 12px; }
      .row > div { flex:1; }

      .hint { font-size: 12px; color:#666; margin-top: 6px; }

      .btn {
        margin-top: 18px;
        width:100%;
        padding: 12px 14px;
        border:0;
        border-radius: 12px;
        font-weight:700;
        cursor:pointer;
        background:#111;
        color:#fff;
        font-size: 15px;
      }

      .footer {
        margin-top: 14px;
        font-size: 12px;
        color:#555;
      }

      .footer a {
        text-decoration: underline;
        text-underline-offset: 2px;
        color: inherit;
      }

      .footer a:hover {
        color:#0B1F3B;
      }

      /* ADDED: status line (non-invasive) */
      .status {
        margin-top: 10px;
        font-size: 13px;
        color: #111;
      }
      .status.error { color: #b00020; }
      .status.ok { color: #0b6b2f; }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="card">
        <h1>Book a courier job</h1>
        <p class="sub">
          Fixed fee within 20 miles. Long-distance is priced by mileage + rules.
          Secure payment via Stripe.
        </p>

        <form id="bookingForm">
          <!-- COMPANY -->
          <label for="company">Company / Business name *</label>
          <input
            id="company"
            name="company"
            type="text"
            required
            placeholder="e.g. ABC Solicitors LLP"
          />

          <!-- PICKUP -->
          <label for="pickup">Pickup address *</label>
          <textarea
            id="pickup"
            name="pickup"
            required
            placeholder="e.g. 10 Downing Street, London SW1A 2AA"
          ></textarea>

          <!-- DROPOFF -->
          <label for="dropoff">Drop-off address *</label>
          <textarea
            id="dropoff"
            name="dropoff"
            required
            placeholder="e.g. 1 St Peter’s Square, Manchester M2 3AE"
          ></textarea>

          <div class="row">
            <div>
              <label for="miles">Estimated miles (use Google Maps)*</label>
              <input
                id="miles"
                name="miles"
                type="number"
                min="1"
                step="1"
                required
                placeholder="e.g. 234"
              />
              <div class="hint">
                Enter an approximate mileage for now (routing automation comes later).
              </div>
            </div>

            <div>
              <label for="email">Your email address *</label>
              <input
                id="email"
                name="email"
                type="email"
                required
                placeholder="you@example.com"
              />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="whenDate">When is this job needed? (date) *</label>
              <input id="whenDate" name="whenDate" type="date" required />
            </div>

            <div>
              <label for="whenTime">Time needed by *</label>
              <input id="whenTime" name="whenTime" type="time" required />
            </div>
          </div>

          <label for="notes">Notes (optional)</label>
          <textarea
            id="notes"
            name="notes"
            placeholder="Fragile items, access instructions, parking, contact name, etc."
          ></textarea>

          <button class="btn" id="submitBtn" type="submit">Book &amp; Pay</button>

          <!-- ADDED: status area -->
          <div id="status" class="status" aria-live="polite"></div>

          <div class="footer">
            By proceeding you agree to our
            <a href="/terms.html">Terms</a>,
            <a href="/refund-policy.html">Refund Policy</a> and
            <a href="/privacy-policy.html">Privacy Policy</a>.
          </div>
        </form>
      </div>
    </div>

    <!-- ADDED: booking submit handler -->
    <script>
      (function () {
        // IMPORTANT: set this to the endpoint you have deployed
        // Examples:
        // const CHECKOUT_ENDPOINT = "/api/create-checkout-session";
        // const CHECKOUT_ENDPOINT = "/api/create-checkout-session-v2";
        const CHECKOUT_ENDPOINT = "/api/create-checkout-session-v2";

        const form = document.getElementById("bookingForm");
        const statusEl = document.getElementById("status");
        const submitBtn = document.getElementById("submitBtn");

        function setStatus(msg, type) {
          statusEl.textContent = msg || "";
          statusEl.className = "status" + (type ? (" " + type) : "");
        }

        form.addEventListener("submit", async function (e) {
          e.preventDefault();

          setStatus("Creating secure payment…", "");
          submitBtn.disabled = true;

          const payload = {
            company: document.getElementById("company").value.trim(),
            pickup: document.getElementById("pickup").value.trim(),
            dropoff: document.getElementById("dropoff").value.trim(),
            miles: document.getElementById("miles").value,
            email: document.getElementById("email").value.trim(),
            whenDate: document.getElementById("whenDate").value,
            whenTime: document.getElementById("whenTime").value,
            notes: document.getElementById("notes").value.trim()
          };

          try {
            const resp = await fetch(CHECKOUT_ENDPOINT, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload)
            });

            const data = await resp.json().catch(() => ({}));

            if (!resp.ok) {
              const msg = data && data.error ? data.error : "Unable to create checkout session.";
              setStatus(msg, "error");
              submitBtn.disabled = false;
              return;
            }

            if (!data.url) {
              setStatus("Checkout session created but no redirect URL returned.", "error");
              submitBtn.disabled = false;
              return;
            }

            // Redirect to Stripe Checkout
            window.location.href = data.url;
          } catch (err) {
            setStatus("Network error. Please try again.", "error");
            submitBtn.disabled = false;
          }
        });
      })();
    </script>
  </body>
</html>
